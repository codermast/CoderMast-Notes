import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as e,a as l,o as a}from"./app-E-nNMN4m.js";const t="/assets/2023-04-11-21-41-30-DCCB76JU.png",n={};function h(r,i){return a(),e("div",null,i[0]||(i[0]=[l('<h1 id="mysql进阶-sql性能分析" tabindex="-1"><a class="header-anchor" href="#mysql进阶-sql性能分析"><span>MySQL进阶 - SQL性能分析</span></a></h1><h2 id="sql执行频率" tabindex="-1"><a class="header-anchor" href="#sql执行频率"><span>SQL执行频率</span></a></h2><p>MySQL客户端连接成功后，通过 SHOW [session | global] status 命令可以查看服务器状态信息。</p><p>通过如下指令，可以查看当前数据库的INSERT、SELECT、UPDATE、DELETE操作的访问频次：</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">SHOW </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">GLOBAL</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> STATUS</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> LIKE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;Com_______&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><blockquote><p>需要注意的是，这里一共有7个空格。</p></blockquote><p>这里查询完成以后就能够看到增删改查的执行次数。</p><ul><li>Com_insert：插入</li><li>Com_update：更新</li><li>Com_select：查询</li><li>Com_delete：删除</li></ul><figure><img src="'+t+`" alt="性能查询" tabindex="0" loading="lazy"><figcaption>性能查询</figcaption></figure><p>我们可以根据这个数据来判断我们主要对那些操作进行优化。</p><h2 id="慢查询日志" tabindex="-1"><a class="header-anchor" href="#慢查询日志"><span>慢查询日志</span></a></h2><p>慢查询日志记录了所有执行时间超过指定参数(long_query_time，单位：秒，默认10秒)的所有SQL语句的日志。</p><p>MySQL中默认不开启慢查询日志，开启的话需要在MySQL的配置文件（/etc/my.cnf）中配置如下信息：</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">-- 开启MySQL中的慢查询</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">slow_query_log </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">-- 设置慢查询的	时间为2秒钟，SQL语句执行超过两秒，则会被视为慢查询，记录慢查询日志</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">long_query_time </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>配置完毕以后，通过以下指令重新启动MySQL服务器进行测试，查看慢日志文件中记录的信息<code>/var/lib/mysql/localhost-slow.log</code></p><div class="hint-container info"><p class="hint-container-title">功能</p><p>慢查询日志主要就是为了记录那些查询时间较长的SQL语句，方便于我们的优化。</p></div><div class="hint-container note"><p class="hint-container-title">前景提要</p><p>通过慢查询日志，我们能够找到查询时间较低的SQL，但是有时候我们对于SQL已经优化到了极致，由于数据量的巨大，无法再压缩SQL的执行时间，或者有些SQL本应该很快执行完毕，但是仍耗费了很长时间，而耗费的时间又在我们慢日志统计时间的临界值，而这类SQL是非常需要我们进行优化的。这两种情况时，需要优化的没有被统计，而无法优化的又被统计到，那么此时慢查询就无法满足我们的需求，这时候就需要使用Profile分析。</p></div><h2 id="profile分析" tabindex="-1"><a class="header-anchor" href="#profile分析"><span>Profile分析</span></a></h2><p>show profiles分析能够在做SQL优化时帮助我们了解时间都耗费到哪去了。通过have_profiling参数，能够看到当前MySQL是否支持profile操作：</p><ul><li>查看是否支持profile</li></ul><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> @@have_profiling;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>默认情况下profile是关闭的，可以通过 set 语句在 globle|session 级别开启profiling;</p><ul><li>开启profile</li></ul><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">set</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> [session|globle]</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> profile</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>查看每一条执行过的SQL语句的耗时情况</li></ul><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">show profiles;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>查看指定query_id 的SQL语句各个阶段的耗时情况</li></ul><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">shwo </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">profile</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> query query_id;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>查看指定query_id 的SQL语句的CPU的使用情况</li></ul><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">show </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">profile</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> cpu </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> query query_id;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="explain执行计划" tabindex="-1"><a class="header-anchor" href="#explain执行计划"><span>explain执行计划</span></a></h2><div class="hint-container note"><p class="hint-container-title">前景提要</p><p>前面我们了解的几种方法要么通过SQL的执行频率，要么通过SQL的执行时间来判断SQL是否需要优化，而这些方式并不能够真正的评判一条SQL的性能。</p></div><p>explain 或者 desc 命令获取MySQL如何执行SELECT语句的信息，包括SELETC语句执行过程中表如何连接和连接的顺序。</p><ul><li>语法</li></ul><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">-- 直接在SELECT语句之前加上关键字 explain 或者 desc</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">EXPLAIN </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 字段列表 </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 表名 </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 条件列表;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>explain执行计划各字段的含义：</p><ul><li><p><strong>id</strong><br> SELECT 查询的序列号，表示查询中执行 SELECT 子句或者是操作表的顺序（id相同，执行顺序从上到下；id不同，值越大，越先执行）。</p></li><li><p>select_type<br> 表示SELECT的类型，常见的取值有SIMPLE（简单表，即不使用表连接或者子查询）、PRIMARY（主查询，即外层的查询）、UNION（UNION中的第二个或者后面的查询语句）、SUBQUERY（SELECT/WHERE之后包含了子查询）等。</p></li><li><p><strong>type</strong>【重要】<br> 表示连接类型，性能由好到差的连接类型为：NULL、system、const、eq_ref、ref、range、index、all。</p></li><li><p>possible_key<br> 显示可能应用到这张表上的索引，一个或者多个。</p></li><li><p>key<br> 实际使用的索引，如果为NULL，则表示没有使用索引。</p></li><li><p>key_len<br> 表示索引中使用的字节数，该值为索引字段最大可能长度，并非实际使用长度，再不损失精度的前提下，长度越短越小。</p></li><li><p>rows<br> MySQL认为必须要执行查询的行数，在innodb引擎的表中，是一个估计值，可能并不总是准确的。</p></li><li><p>filtered<br> 表示查询返回结果的行数占需要的读取行数的百分比，filtered的值越大越好。</p></li><li><p>extra<br> 备注信息，一般为NULL。</p></li></ul>`,37)]))}const k=s(n,[["render",h],["__file","sql-perfomance-analysis.html.vue"]]),o=JSON.parse('{"path":"/database/mysql/sql-perfomance-analysis.html","title":"MySQL进阶 - SQL性能分析","lang":"zh-CN","frontmatter":{"order":14,"description":"MySQL进阶 - SQL性能分析 SQL执行频率 MySQL客户端连接成功后，通过 SHOW [session | global] status 命令可以查看服务器状态信息。 通过如下指令，可以查看当前数据库的INSERT、SELECT、UPDATE、DELETE操作的访问频次： 需要注意的是，这里一共有7个空格。 这里查询完成以后就能够看到增删改查...","head":[["meta",{"property":"og:url","content":"https://www.codermast.com/database/mysql/sql-perfomance-analysis.html"}],["meta",{"property":"og:site_name","content":"友人的编程指南"}],["meta",{"property":"og:title","content":"MySQL进阶 - SQL性能分析"}],["meta",{"property":"og:description","content":"MySQL进阶 - SQL性能分析 SQL执行频率 MySQL客户端连接成功后，通过 SHOW [session | global] status 命令可以查看服务器状态信息。 通过如下指令，可以查看当前数据库的INSERT、SELECT、UPDATE、DELETE操作的访问频次： 需要注意的是，这里一共有7个空格。 这里查询完成以后就能够看到增删改查..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2023-06-13T13:22:27.000Z"}],["meta",{"property":"article:author","content":"友人"}],["meta",{"property":"article:modified_time","content":"2023-06-13T13:22:27.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"MySQL进阶 - SQL性能分析\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2023-06-13T13:22:27.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"友人\\",\\"url\\":\\"https://www.codermast.com\\",\\"email\\":\\"codermast@163.com\\"}]}"]]},"headers":[{"level":2,"title":"SQL执行频率","slug":"sql执行频率","link":"#sql执行频率","children":[]},{"level":2,"title":"慢查询日志","slug":"慢查询日志","link":"#慢查询日志","children":[]},{"level":2,"title":"Profile分析","slug":"profile分析","link":"#profile分析","children":[]},{"level":2,"title":"explain执行计划","slug":"explain执行计划","link":"#explain执行计划","children":[]}],"git":{"createdTime":1681442349000,"updatedTime":1686662547000,"contributors":[{"name":"codermast","email":"codermast@qq.com","commits":2}]},"readingTime":{"minutes":3.89,"words":1166},"filePathRelative":"database/mysql/sql-perfomance-analysis.md","localizedDate":"2023年4月14日","autoDesc":true,"excerpt":"\\n<h2>SQL执行频率</h2>\\n<p>MySQL客户端连接成功后，通过 SHOW [session | global] status 命令可以查看服务器状态信息。</p>\\n<p>通过如下指令，可以查看当前数据库的INSERT、SELECT、UPDATE、DELETE操作的访问频次：</p>\\n<div class=\\"language-sql line-numbers-mode\\" data-highlighter=\\"shiki\\" data-ext=\\"sql\\" data-title=\\"sql\\" style=\\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\\"><pre class=\\"shiki shiki-themes one-light one-dark-pro vp-code\\"><code><span class=\\"line\\"><span style=\\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\\">SHOW </span><span style=\\"--shiki-light:#A626A4;--shiki-dark:#C678DD\\">GLOBAL</span><span style=\\"--shiki-light:#A626A4;--shiki-dark:#C678DD\\"> STATUS</span><span style=\\"--shiki-light:#A626A4;--shiki-dark:#C678DD\\"> LIKE</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> \\"Com_______\\"</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\\">;</span></span></code></pre>\\n<div class=\\"line-numbers\\" aria-hidden=\\"true\\" style=\\"counter-reset:line-number 0\\"><div class=\\"line-number\\"></div></div></div>"}');export{k as comp,o as data};
